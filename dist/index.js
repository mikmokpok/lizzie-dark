const express=require("express"),nodemailer=require("nodemailer"),bodyParser=require("body-parser"),{request:request}=require("http");path=require("path"),app=express(),app.use(bodyParser.urlencoded({extended:!0})),app.use(bodyParser.json()),app.set("port",process.env.PORT||8080),app.use(express.static(path.join(__dirname,"/"))),app.get("/glide.min.js",(e,s)=>{s.sendFile(path.join(__dirname,"..","node_modules","@glidejs","glide","dist","glide.min.js"))}),app.post("/contact",(e,r)=>{if(!e.body.captcha)return r.json({success:!1,msg:"Wypełnij captchę."});var s=`http://google.com/recaptcha/api/siteverify?secret=${process.env.CAP}&response=${e.body.captcha}&remoteip=${e.connection.remoteAddress}`;request(s,(e,s,o)=>{o=JSON.parse(o);if(void 0!==o.success&&!o.success)return r.json({success:!1,msg:"Weryfikacja captchy zakończona niepowodzeniem."})});const o=nodemailer.createTransport({host:"smtp.gmail.com",port:465,secure:!0,auth:{user:process.env.SLOG,pass:process.env.SPAS}});e={from:"Lizzie",to:process.env.TARGET,subject:e.body.subject,text:`Od: ${e.body.name} (${e.body.email}). Wiadomość: ${e.body.message}`};o.sendMail(e,(e,s)=>e?r.json({success:!1,msg:"Błąd wysyłania."}):r.json({success:!0,msg:"Wiadomość wysłana!"}))});const server=app.listen(app.get("port"),function(){console.log("The server is running on http://localhost:"+app.get("port"))});